<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>在线工具箱</title>
  <meta name="description" content="免费在线工具箱，提供时间戳转换、字符串对比合并、经纬度坐标系转换等实用工具，支持WGS84、GCJ02、BD09坐标系转换" />
  <meta name="keywords" content="时间戳转换,经纬度转换,字符串对比,在线工具,坐标转换,WGS84,GCJ02,BD09" />
  <meta name="author" content="Devin" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🛠️</text></svg>" />
  <style>
    :root{
      --bg:#f5f6f8;--card:#fff;--text:#111;--muted:#6b7280;--border:#e5e7eb;--primary:#111827;
      --green:#dcfce7;--red:#fee2e2;--yellow:#fef3c7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";color:var(--text)}
    .container{max-width:1040px;margin:0 auto;padding:24px}
    header{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}
    .header-row{display:flex;align-items:center;justify-content:space-between}
    h1{font-size:22px;margin:0}
    .link{font-size:12px;color:#6b7280;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* Tabs */
    .tabs{display:flex;gap:8px;background:#fff;padding:6px;border:1px solid var(--border);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .tab{padding:8px 16px;border-radius:12px;background:transparent;color:#374151;border:0;cursor:pointer}
    .tab[aria-selected="true"]{background:var(--primary);color:#fff}
    .card{background:var(--card);border-radius:16px;padding:24px;box-shadow:0 1px 2px rgba(0,0,0,.06);border:1px solid var(--border);margin-bottom:24px}
    .card h2{margin:0 0 12px;font-size:18px}
    .row{display:grid;gap:12px}
    @media(min-width:860px){.row-3{grid-template-columns:1fr 1fr 1fr}}
    .btn{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer}
    .btn:hover{background:#f9fafb}
    .btn.dark{background:var(--primary);color:#fff;border-color:#111}
    .btn.badge{position:relative}
    .toast{position:absolute;left:50%;transform:translateX(-50%);margin-top:8px;font-size:12px;padding:4px 8px;border-radius:10px;background:rgba(0,0,0,.8);color:#fff;white-space:nowrap}
    .muted{color:var(--muted);font-size:12px}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    textarea{height:160px}
    .grid-2{display:grid;gap:16px}
    @media(min-width:980px){.grid-2{grid-template-columns:1fr 1fr}}
    .diff-tag.eq{background:#f9fafb}
    .diff-tag.add{background:var(--green)}
    .diff-tag.del{background:var(--red)}
    .diff-tag.replace{background:var(--yellow)}
    .flex{display:flex;gap:8px;align-items:center}
    .space-y> *{margin-bottom:12px}
    footer{color:#9ca3af;font-size:12px;text-align:center;padding:24px 0}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-row">
        <h1>工具箱</h1>
      </div>
      <div class="tabs" role="tablist" aria-label="工具切换">
        <button class="tab" id="tab-ts" role="tab" aria-controls="panel-ts" aria-selected="true">时间戳转换</button>
        <button class="tab" id="tab-diff" role="tab" aria-controls="panel-diff" aria-selected="false">字符串对比</button>
        <button class="tab" id="tab-coord" role="tab" aria-controls="panel-coord" aria-selected="false">经纬度转换</button>
      </div>
    </header>

    <section id="panel-ts" role="tabpanel" aria-labelledby="tab-ts">
      <div class="card">
        <div class="flex" style="justify-content:space-between; margin-bottom:12px">
          <h2>时间戳转换</h2>
          <div class="flex">
            <label class="muted" for="tzSelect">时区：</label>
            <select id="tzSelect"></select>
          </div>
        </div>

        <div class="row row-3" style="align-items:end; gap:16px">
          <div style="grid-column: span 2">
            <div class="muted" style="margin-bottom:6px">当前时间戳（秒）</div>
            <input id="currentTs" readonly />
            <div class="flex" style="margin-top:10px">
              <button class="btn" id="tickToggle">停止</button>
              <span class="muted">只读，固定显示“秒”，不随单位切换。</span>
              <span class="btn badge" id="copyCurrentWrap"><button class="btn" id="copyCurrent">复制</button></span>
            </div>
          </div>
        </div>

        <hr style="border:none;border-top:1px solid var(--border); margin:16px 0" />

        <div class="row" style="grid-template-columns:1fr auto 1fr auto; align-items:center">
          <input id="epochInput" placeholder="时间戳，例如 1757733595432" />
          <select id="epochUnit">
            <option value="ms">毫秒(ms)</option>
            <option value="s" selected>秒(s)</option>
          </select>
          <button class="btn dark" id="btnEpochToDate">转换 →</button>
          <div class="flex">
            <input id="epochOut" readonly />
            <button class="btn" id="copyEpochOut">复制</button>
          </div>
        </div>

        <div class="row" style="grid-template-columns:1fr auto 1fr auto; align-items:center; margin-top:16px">
          <input id="dtInput" placeholder="日期时间，例如 2025-09-13 11:19:55" />
          <div class="muted">→</div>
          <button class="btn dark" id="btnDateToEpoch">转换</button>
          <div class="flex">
            <input id="dtOut" readonly />
            <button class="btn" id="copyDtOut">复制</button>
          </div>
        </div>

        <p class="muted" style="margin-top:10px">说明：上面的“日期时间→时间戳”会把你输入的时间视为所选时区下的本地时间来换算为 Unix 毫秒时间戳。</p>
      </div>

      
    </section>

    <section id="panel-diff" role="tabpanel" aria-labelledby="tab-diff" hidden>
      <div class="card">
        <div class="flex" style="justify-content:space-between; margin-bottom:12px">
          <h2>字符串比对与手动合并</h2>
          <div class="flex">
            <button class="btn" id="btnDoDiff">开始对比</button>
            <button class="btn" id="copyMerged">复制合并结果</button>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <div class="muted" style="margin-bottom:6px">原始字符串</div>
            <textarea id="leftText" placeholder="在这里粘贴左侧（原始）字符串"></textarea>
          </div>
          <div>
            <div class="muted" style="margin-bottom:6px">对比字符串</div>
            <textarea id="rightText" placeholder="在这里粘贴右侧（对比）字符串"></textarea>
          </div>
        </div>

        <div id="diffContainer" class="space-y" style="margin-top:16px"></div>

        <div style="margin-top:16px">
          <div class="muted" style="margin-bottom:6px">合并结果（可二次编辑）</div>
          <textarea id="mergedOut" readonly></textarea>
        </div>
      </div>
    </section>

    <section id="panel-coord" role="tabpanel" aria-labelledby="tab-coord" hidden>
      <div class="card">
        <div class="flex" style="justify-content:space-between; margin-bottom:12px">
          <h2>经纬度转换</h2>
          <div class="flex">
            <button class="btn" id="clearCoord">清空</button>
          </div>
        </div>

        <div style="margin-bottom:16px">
          <div class="muted" style="margin-bottom:6px">原始坐标</div>
          <div class="row" style="grid-template-columns:1fr 1fr auto; gap:12px; align-items:end">
            <div>
              <input id="sourceLng" placeholder="经度 (Longitude)" />
            </div>
            <div>
              <input id="sourceLat" placeholder="纬度 (Latitude)" />
            </div>
            <select id="sourceCoordSys">
              <option value="WGS84">WGS84 (国际标准)</option>
              <option value="GCJ02">GCJ02 (火星坐标系)</option>
              <option value="BD09">BD09 (百度坐标系)</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom:16px">
          <div class="muted" style="margin-bottom:6px">目标坐标系</div>
          <select id="targetCoordSys">
            <option value="WGS84">WGS84 (国际标准)</option>
            <option value="GCJ02">GCJ02 (火星坐标系)</option>
            <option value="BD09">BD09 (百度坐标系)</option>
          </select>
        </div>

        <div style="margin-bottom:16px">
          <button class="btn dark" id="btnConvertCoord">转换坐标</button>
        </div>

        <div>
          <div class="muted" style="margin-bottom:6px">转换结果</div>
          <div class="row" style="grid-template-columns:1fr 1fr auto; gap:12px; align-items:center">
            <input id="resultLng" readonly placeholder="经度结果" />
            <input id="resultLat" readonly placeholder="纬度结果" />
            <button class="btn" id="copyCoordResult">复制</button>
          </div>
        </div>

        <div style="margin-top:16px">
          <div class="muted">
            <strong>坐标系说明：</strong><br/>
            • <strong>WGS84</strong>：国际标准，GPS设备、Google Earth等使用<br/>
            • <strong>GCJ02</strong>：中国国家测绘局加密坐标，高德、腾讯地图等使用<br/>
            • <strong>BD09</strong>：百度加密坐标，百度地图使用
          </div>
        </div>
      </div>

      <div class="card">
        <div class="flex" style="justify-content:space-between; margin-bottom:12px">
          <h2>批量转换</h2>
          <div class="flex">
            <button class="btn" id="btnBatchConvert">批量转换</button>
            <button class="btn" id="copyBatchResult">复制结果</button>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <div class="muted" style="margin-bottom:6px">输入坐标（每行一个，格式：经度,纬度）</div>
            <textarea id="batchInput" placeholder="116.397128,39.916527
121.473701,31.230416
113.264435,23.129163"></textarea>
          </div>
          <div>
            <div class="muted" style="margin-bottom:6px">转换结果</div>
            <textarea id="batchOutput" readonly></textarea>
          </div>
        </div>

        <div class="row" style="grid-template-columns:1fr 1fr; gap:16px; margin-top:12px">
          <div>
            <label class="muted">源坐标系：</label>
            <select id="batchSourceCoordSys">
              <option value="WGS84">WGS84</option>
              <option value="GCJ02">GCJ02</option>
              <option value="BD09">BD09</option>
            </select>
          </div>
          <div>
            <label class="muted">目标坐标系：</label>
            <select id="batchTargetCoordSys">
              <option value="WGS84">WGS84</option>
              <option value="GCJ02">GCJ02</option>
              <option value="BD09">BD09</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <footer>© <span id="year"></span> – Devin - juju</footer>
  </div>

<script>
// ---------------------- Utils ----------------------
const TZ_LIST = [
  "UTC","Asia/Shanghai","Asia/Tokyo","Asia/Kolkata","Europe/London","Europe/Berlin","America/New_York","America/Los_Angeles","Australia/Sydney"
];
function $(sel, root=document){return root.querySelector(sel)}
function h(tag, props={}, ...children){const el=document.createElement(tag);Object.assign(el, props);children.flat().forEach(c=>{if(c==null)return; if(c.nodeType) el.appendChild(c); else el.appendChild(document.createTextNode(String(c)));});return el}
function classNames(){return Array.from(arguments).filter(Boolean).join(' ')}

function formatWithTZ(tsMs, timeZone){
  const d=new Date(tsMs);
  const fmt=new Intl.DateTimeFormat('zh-CN',{timeZone,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
  return fmt.format(d).replaceAll('/','-').replace(',','').replaceAll('\u00A0',' ');
}
function getOffsetMs(instantDate, timeZone){
  const dtf=new Intl.DateTimeFormat('en-US',{timeZone,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false});
  const parts=Object.fromEntries(dtf.formatToParts(instantDate).map(p=>[p.type,p.value]));
  const asIf=Date.UTC(+parts.year, +parts.month-1, +parts.day, +parts.hour, +parts.minute, +parts.second);
  return asIf - instantDate.getTime();
}
function parseLocalLike(input){
  if(!input) return null;
  const s=input.trim().replace('T',' ');
  const m=s.match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{2}):(\d{2})(?::(\d{2}))?$/);
  if(!m) return null; const [,y,M,d,h,mn,ss]=m;
  return {year:+y,month:+M,day:+d,hour:+h,minute:+mn,second:+(ss||0)};
}
function localInTZToEpochMs(parts, tz){
  const {year,month,day,hour,minute,second}=parts;
  const guessUTC=Date.UTC(year,month-1,day,hour,minute,second);
  const offset=getOffsetMs(new Date(guessUTC), tz);
  return guessUTC - offset;
}

// Clipboard fallback
async function copyWithFallback(text){
  try{ if(navigator.clipboard){ await navigator.clipboard.writeText(text); return {ok:true}; } }catch(e){}
  try{ const ta=h('textarea',{value:text,style:'position:fixed;opacity:0;left:-9999px'}); document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); return {ok:true}; }catch(e){}
  return {ok:false};
}
function withToast(wrapperEl, fn){
  return async()=>{
    const res=await fn();
    const toast=h('div',{className:'toast'}, res && res.ok? '已复制':'复制失败');
    wrapperEl.appendChild(toast); setTimeout(()=>toast.remove(),1600);
  }
}

// ---------------------- Tabs ----------------------
(function initTabs(){
  const tabTs=$('#tab-ts'), tabDiff=$('#tab-diff'), tabCoord=$('#tab-coord');
  const panelTs=$('#panel-ts'), panelDiff=$('#panel-diff'), panelCoord=$('#panel-coord');
  function activate(key){
    const isTs=key==='ts', isDiff=key==='diff', isCoord=key==='coord';
    tabTs.setAttribute('aria-selected', isTs);
    tabDiff.setAttribute('aria-selected', isDiff);
    tabCoord.setAttribute('aria-selected', isCoord);
    panelTs.hidden=!isTs; panelDiff.hidden=!isDiff; panelCoord.hidden=!isCoord;
  }
  tabTs.addEventListener('click',()=>activate('ts'));
  tabDiff.addEventListener('click',()=>activate('diff'));
  tabCoord.addEventListener('click',()=>activate('coord'));
  activate('ts');
})();

// ---------------------- Timestamp Tools ----------------------
(function initTimestamp(){
  const tzSelect=$('#tzSelect'); TZ_LIST.forEach(z=>tzSelect.appendChild(h('option',{value:z,textContent:z})));
  tzSelect.value='Asia/Shanghai';

  const currentTs=$('#currentTs');
  const tickToggle=$('#tickToggle');
  const copyCurrentWrap=$('#copyCurrentWrap');
  const copyCurrent=$('#copyCurrent');

  // 顶部固定秒级显示
  function updateCurrent(){ currentTs.value=String(Math.floor(Date.now()/1000)); }
  let running=true; let timer=setInterval(updateCurrent,250); updateCurrent();
  tickToggle.addEventListener('click',()=>{ running=!running; tickToggle.textContent=running?'停止':'启动'; if(running){ timer=setInterval(updateCurrent,250);} else { clearInterval(timer);} });
  copyCurrent.addEventListener('click', withToast(copyCurrentWrap, ()=>copyWithFallback(currentTs.value)));

  // 下方转换：进入时自动带入进入时刻（秒）
  const epochInput=$('#epochInput'); epochInput.value=String(Math.floor(Date.now()/1000));
  const epochUnit=$('#epochUnit'); epochUnit.value='s';
  epochUnit.addEventListener('change',()=>{
    const prev=epochInput.value.trim(); if(!prev) return;
    if(epochUnit.value==='ms'){ epochInput.value = prev + '000'; }
    else { epochInput.value = prev.endsWith('000') ? prev.slice(0,-3) : String(Math.floor(Number(prev)/1000)); }
  });

  const epochOut=$('#epochOut');
  $('#btnEpochToDate').addEventListener('click',()=>{
    const raw=epochInput.value.trim(); if(!raw){ epochOut.value=''; return; }
    const n=Number(raw); if(Number.isNaN(n)){ epochOut.value='格式错误'; return; }
    const tsMs= epochUnit.value==='ms' ? n : n*1000;
    epochOut.value = formatWithTZ(tsMs, tzSelect.value);
  });
  $('#copyEpochOut').addEventListener('click', async()=>{ await copyWithFallback(epochOut.value); });

  const dtInput=$('#dtInput'); const dtOut=$('#dtOut');
  $('#btnDateToEpoch').addEventListener('click',()=>{
    const parts=parseLocalLike(dtInput.value);
    if(!parts){ dtOut.value='格式错误，示例：2025-09-13 11:19:55'; return; }
    try{ const ms=localInTZToEpochMs(parts, tzSelect.value); dtOut.value=String(ms); }catch(e){ dtOut.value='转换失败: '+e.message; }
  });
  $('#copyDtOut').addEventListener('click', async()=>{ await copyWithFallback(dtOut.value); });
})();

// ---------------------- Tests (removed as elements don't exist) ----------------------

// ---------------------- Coordinate Conversion ----------------------
(function initCoordConversion(){
  // 坐标转换算法
  const PI = Math.PI;
  const A = 6378245.0;
  const EE = 0.00669342162296594323;
  
  function outOfChina(lng, lat) {
    return (lng < 72.004 || lng > 137.8347) || (lat < 0.8293 || lat > 55.8271);
  }
  
  function transformLat(lng, lat) {
    let ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * Math.sqrt(Math.abs(lng));
    ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
    ret += (20.0 * Math.sin(lat * PI) + 40.0 * Math.sin(lat / 3.0 * PI)) * 2.0 / 3.0;
    ret += (160.0 * Math.sin(lat / 12.0 * PI) + 320 * Math.sin(lat * PI / 30.0)) * 2.0 / 3.0;
    return ret;
  }
  
  function transformLng(lng, lat) {
    let ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * Math.sqrt(Math.abs(lng));
    ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
    ret += (20.0 * Math.sin(lng * PI) + 40.0 * Math.sin(lng / 3.0 * PI)) * 2.0 / 3.0;
    ret += (150.0 * Math.sin(lng / 12.0 * PI) + 300.0 * Math.sin(lng / 30.0 * PI)) * 2.0 / 3.0;
    return ret;
  }
  
  // WGS84 to GCJ02
  function wgs84ToGcj02(lng, lat) {
    if (outOfChina(lng, lat)) return [lng, lat];
    let dLat = transformLat(lng - 105.0, lat - 35.0);
    let dLng = transformLng(lng - 105.0, lat - 35.0);
    const radLat = lat / 180.0 * PI;
    let magic = Math.sin(radLat);
    magic = 1 - EE * magic * magic;
    const sqrtMagic = Math.sqrt(magic);
    dLat = (dLat * 180.0) / ((A * (1 - EE)) / (magic * sqrtMagic) * PI);
    dLng = (dLng * 180.0) / (A / sqrtMagic * Math.cos(radLat) * PI);
    return [lng + dLng, lat + dLat];
  }
  
  // GCJ02 to WGS84
  function gcj02ToWgs84(lng, lat) {
    if (outOfChina(lng, lat)) return [lng, lat];
    let dLat = transformLat(lng - 105.0, lat - 35.0);
    let dLng = transformLng(lng - 105.0, lat - 35.0);
    const radLat = lat / 180.0 * PI;
    let magic = Math.sin(radLat);
    magic = 1 - EE * magic * magic;
    const sqrtMagic = Math.sqrt(magic);
    dLat = (dLat * 180.0) / ((A * (1 - EE)) / (magic * sqrtMagic) * PI);
    dLng = (dLng * 180.0) / (A / sqrtMagic * Math.cos(radLat) * PI);
    return [lng - dLng, lat - dLat];
  }
  
  // GCJ02 to BD09
  function gcj02ToBd09(lng, lat) {
    const z = Math.sqrt(lng * lng + lat * lat) + 0.00002 * Math.sin(lat * PI * 3000.0 / 180.0);
    const theta = Math.atan2(lat, lng) + 0.000003 * Math.cos(lng * PI * 3000.0 / 180.0);
    const bdLng = z * Math.cos(theta) + 0.0065;
    const bdLat = z * Math.sin(theta) + 0.006;
    return [bdLng, bdLat];
  }
  
  // BD09 to GCJ02
  function bd09ToGcj02(lng, lat) {
    const x = lng - 0.0065;
    const y = lat - 0.006;
    const z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * PI * 3000.0 / 180.0);
    const theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * PI * 3000.0 / 180.0);
    const gcjLng = z * Math.cos(theta);
    const gcjLat = z * Math.sin(theta);
    return [gcjLng, gcjLat];
  }
  
  // 主转换函数
  function convertCoordinates(lng, lat, fromSys, toSys) {
    if (fromSys === toSys) return [lng, lat];
    
    let result = [lng, lat];
    
    // 先转换到GCJ02作为中间坐标系
    if (fromSys === 'WGS84') {
      result = wgs84ToGcj02(lng, lat);
    } else if (fromSys === 'BD09') {
      result = bd09ToGcj02(lng, lat);
    }
    
    // 从GCJ02转换到目标坐标系
    if (toSys === 'WGS84') {
      result = gcj02ToWgs84(result[0], result[1]);
    } else if (toSys === 'BD09') {
      result = gcj02ToBd09(result[0], result[1]);
    }
    
    return result;
  }
  
  // UI 绑定
  const sourceLng = $('#sourceLng');
  const sourceLat = $('#sourceLat');
  const sourceCoordSys = $('#sourceCoordSys');
  const targetCoordSys = $('#targetCoordSys');
  const resultLng = $('#resultLng');
  const resultLat = $('#resultLat');
  
  $('#btnConvertCoord').addEventListener('click', () => {
    const lng = parseFloat(sourceLng.value);
    const lat = parseFloat(sourceLat.value);
    
    if (isNaN(lng) || isNaN(lat)) {
      resultLng.value = '请输入有效的经纬度';
      resultLat.value = '';
      return;
    }
    
    if (lng < -180 || lng > 180 || lat < -90 || lat > 90) {
      resultLng.value = '坐标范围错误';
      resultLat.value = '经度[-180,180]，纬度[-90,90]';
      return;
    }
    
    try {
      const result = convertCoordinates(lng, lat, sourceCoordSys.value, targetCoordSys.value);
      resultLng.value = result[0].toFixed(8);
      resultLat.value = result[1].toFixed(8);
    } catch (e) {
      resultLng.value = '转换失败';
      resultLat.value = e.message;
    }
  });
  
  $('#clearCoord').addEventListener('click', () => {
    sourceLng.value = '';
    sourceLat.value = '';
    resultLng.value = '';
    resultLat.value = '';
  });
  
  $('#copyCoordResult').addEventListener('click', async () => {
    const result = `${resultLng.value},${resultLat.value}`;
    await copyWithFallback(result);
  });
  
  // 批量转换
  const batchInput = $('#batchInput');
  const batchOutput = $('#batchOutput');
  const batchSourceCoordSys = $('#batchSourceCoordSys');
  const batchTargetCoordSys = $('#batchTargetCoordSys');
  
  $('#btnBatchConvert').addEventListener('click', () => {
    const lines = batchInput.value.split('\n').filter(line => line.trim());
    const results = [];
    
    for (const line of lines) {
      const parts = line.trim().split(',');
      if (parts.length !== 2) {
        results.push(`${line} - 格式错误`);
        continue;
      }
      
      const lng = parseFloat(parts[0]);
      const lat = parseFloat(parts[1]);
      
      if (isNaN(lng) || isNaN(lat)) {
        results.push(`${line} - 无效坐标`);
        continue;
      }
      
      try {
        const result = convertCoordinates(lng, lat, batchSourceCoordSys.value, batchTargetCoordSys.value);
        results.push(`${result[0].toFixed(8)},${result[1].toFixed(8)}`);
      } catch (e) {
        results.push(`${line} - 转换失败`);
      }
    }
    
    batchOutput.value = results.join('\n');
  });
  
  $('#copyBatchResult').addEventListener('click', async () => {
    await copyWithFallback(batchOutput.value);
  });
})();

// ---------------------- Diff & Merge ----------------------
(function initDiff(){
  const left=$('#leftText'); const right=$('#rightText');
  const container=$('#diffContainer'); const mergedOut=$('#mergedOut');
  const copyMerged=$('#copyMerged'); copyMerged.addEventListener('click', async()=>{ await copyWithFallback(mergedOut.value); });

  function tokenize(str){ const arr=[]; let buf=''; const flush=()=>{ if(buf){arr.push({t:buf,k:'w'}); buf='';}}; for(const ch of str){ if(/\w|[\u4e00-\u9fa5]/.test(ch)) buf+=ch; else { flush(); arr.push({t:ch,k:'s'});} } flush(); return arr; }
  function lcs(a,b){ const n=a.length,m=b.length; const dp=Array.from({length:n+1},()=>Array(m+1).fill(0)); for(let i=n-1;i>=0;i--){ for(let j=m-1;j>=0;j--){ dp[i][j] = a[i].t===b[j].t ? dp[i+1][j+1]+1 : Math.max(dp[i+1][j], dp[i][j+1]); } } const res=[]; let i=0,j=0; while(i<n&&j<m){ if(a[i].t===b[j].t){ res.push({type:'eq',token:a[i]}); i++; j++; } else if(dp[i+1][j]>=dp[i][j+1]){ res.push({type:'del',token:a[i++]}); } else { res.push({type:'add',token:b[j++]}); } } while(i<n) res.push({type:'del',token:a[i++]}); while(j<m) res.push({type:'add',token:b[j++]}); return res; }

  function doDiff(){
    const A=tokenize(left.value||'');
    const B=tokenize(right.value||'');
    const seq=lcs(A,B);
    const groups=[]; let i=0; while(i<seq.length){ const cur=seq[i]; if(cur.type==='eq'){ let text=cur.token.t; i++; while(i<seq.length && seq[i].type==='eq'){ text+=seq[i].token.t; i++; } groups.push({kind:'eq', a:text, b:text, key:groups.length}); continue; } let dels=''; while(i<seq.length && seq[i].type==='del'){ dels+=seq[i].token.t; i++; } let adds=''; while(i<seq.length && seq[i].type==='add'){ adds+=seq[i].token.t; i++; } if(dels && adds) groups.push({kind:'replace', a:dels, b:adds, key:groups.length}); else if(dels) groups.push({kind:'del', a:dels, b:'', key:groups.length}); else if(adds) groups.push({kind:'add', a:'', b:adds, key:groups.length}); }

    container.innerHTML=''; const picked={};
    groups.forEach(g=>{
      if(g.kind!=='eq') picked[g.key]='right';
      const header=h('div',{className:classNames('flex'), style:'justify-content:space-between; padding:8px; border-bottom:1px solid var(--border);'},
        h('div',{textContent: g.kind==='eq'?'一致': g.kind==='add'?'增加(右)': g.kind==='del'?'删除(左)':'替换'}),
        g.kind==='eq'? null : h('div',{},
          h('label',{}, h('input',{type:'radio',name:'pick-'+g.key,checked:false,onchange:()=>{picked[g.key]='left'; renderMerged();}}), ' 选左(原始) '),
          h('label',{}, h('input',{type:'radio',name:'pick-'+g.key,checked:true,onchange:()=>{picked[g.key]='right'; renderMerged();}}), ' 选右(对比) ')
        )
      );
      const body=h('div',{className:'grid-2',style:'padding:8px'},
        h('div',{}, h('div',{className:'muted',textContent:'左(原始)'}), h('div',{}, g.a||'⟂')),
        h('div',{}, h('div',{className:'muted',textContent:'右(对比)' }), h('div',{}, g.b||'⟂'))
      );
      const wrap=h('div',{className:'diff-tag '+g.kind, style:'border:1px solid var(--border); border-radius:12px; overflow:hidden'} , header, body);
      container.appendChild(wrap);
    });

    function renderMerged(){ mergedOut.value = groups.map(g=> g.kind==='eq'? g.a : (picked[g.key]==='left'? g.a : g.b)).join(''); }
    renderMerged();
  }

  $('#btnDoDiff').addEventListener('click', doDiff);
})();

// Misc
const toTopEl = $('#toTop');
if (toTopEl) {
  toTopEl.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
}
$('#year').textContent = new Date().getFullYear();
</script>
</body>
</html>

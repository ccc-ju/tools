<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>åœ¨çº¿å·¥å…·ç®±</title>
  <meta name="description" content="å…è´¹åœ¨çº¿å·¥å…·ç®±ï¼Œæä¾›æ—¶é—´æˆ³è½¬æ¢ã€å­—ç¬¦ä¸²å¯¹æ¯”åˆå¹¶ã€ç»çº¬åº¦åæ ‡ç³»è½¬æ¢ç­‰å®ç”¨å·¥å…·ï¼Œæ”¯æŒWGS84ã€GCJ02ã€BD09åæ ‡ç³»è½¬æ¢" />
  <meta name="keywords" content="æ—¶é—´æˆ³è½¬æ¢,ç»çº¬åº¦è½¬æ¢,å­—ç¬¦ä¸²å¯¹æ¯”,åœ¨çº¿å·¥å…·,åæ ‡è½¬æ¢,WGS84,GCJ02,BD09" />
  <meta name="author" content="Devin" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ› ï¸</text></svg>" />
  <style>
    :root{
      --bg:#f5f6f8;--card:#fff;--text:#111;--muted:#6b7280;--border:#e5e7eb;--primary:#111827;
      --green:#dcfce7;--red:#fee2e2;--yellow:#fef3c7;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:var(--bg);font:14px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";color:var(--text)}
    .container{max-width:1040px;margin:0 auto;padding:24px}
    header{display:flex;flex-direction:column;gap:12px;margin-bottom:24px}
    .header-row{display:flex;align-items:center;justify-content:space-between}
    h1{font-size:22px;margin:0}
    .link{font-size:12px;color:#6b7280;text-decoration:none}
    .link:hover{text-decoration:underline}
    /* Tabs */
    .tabs{display:flex;gap:8px;background:#fff;padding:6px;border:1px solid var(--border);border-radius:16px;box-shadow:0 1px 2px rgba(0,0,0,.04)}
    .tab{padding:8px 16px;border-radius:12px;background:transparent;color:#374151;border:0;cursor:pointer}
    .tab[aria-selected="true"]{background:var(--primary);color:#fff}
    .card{background:var(--card);border-radius:16px;padding:24px;box-shadow:0 1px 2px rgba(0,0,0,.06);border:1px solid var(--border);margin-bottom:24px}
    .card h2{margin:0 0 12px;font-size:18px}
    .row{display:grid;gap:12px}
    @media(min-width:860px){.row-3{grid-template-columns:1fr 1fr 1fr}}
    .btn{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer}
    .btn:hover{background:#f9fafb}
    .btn.dark{background:var(--primary);color:#fff;border-color:#111}
    .btn.badge{position:relative}
    .toast{position:absolute;left:50%;transform:translateX(-50%);margin-top:8px;font-size:12px;padding:4px 8px;border-radius:10px;background:rgba(0,0,0,.8);color:#fff;white-space:nowrap}
    .muted{color:var(--muted);font-size:12px}
    input,select,textarea{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    input[readonly]{background:#f8f9fa;color:#495057}
    textarea{min-height:160px}
    .grid-2{display:grid;gap:16px}
    @media(min-width:980px){.grid-2{grid-template-columns:1fr 1fr}}
    .btn{padding:8px 12px;border:1px solid var(--border);border-radius:12px;background:#fff;cursor:pointer;font-weight:500;transition:all 0.2s}
    .btn:hover{background:#f8f9fa;transform:translateY(-1px)}
    .btn.dark{background:var(--primary);color:#fff;border-color:#111}
    .btn.dark:hover{background:#374151;transform:translateY(-1px)}
    .diff-tag.eq{background:#f9fafb}
    .diff-tag.add{background:var(--green)}
    .diff-tag.del{background:var(--red)}
    .diff-tag.replace{background:var(--yellow)}
    .flex{display:flex;gap:8px;align-items:center}
    .space-y> *{margin-bottom:12px}
    footer{color:#9ca3af;font-size:12px;text-align:center;padding:24px 0}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-row">
        <h1>å·¥å…·ç®±</h1>
      </div>
      <div class="tabs" role="tablist" aria-label="å·¥å…·åˆ‡æ¢">
        <button class="tab" id="tab-ts" role="tab" aria-controls="panel-ts" aria-selected="true">æ—¶é—´æˆ³è½¬æ¢</button>
        <button class="tab" id="tab-diff" role="tab" aria-controls="panel-diff" aria-selected="false">å­—ç¬¦ä¸²å¯¹æ¯”</button>
        <button class="tab" id="tab-coord" role="tab" aria-controls="panel-coord" aria-selected="false">ç»çº¬åº¦è½¬æ¢</button>
      </div>
    </header>

    <section id="panel-ts" role="tabpanel" aria-labelledby="tab-ts">
      <div class="card">
        <h2>æ—¶é—´æˆ³è½¬æ¢</h2>
        
        <!-- å½“å‰æ—¶é—´æ˜¾ç¤º -->
        <div style="margin-bottom:32px">
          <div class="muted" style="margin-bottom:12px; font-weight:500">å½“å‰æ—¶é—´</div>
          <div class="row" style="grid-template-columns:1fr auto auto; gap:16px; align-items:center">
            <input id="currentTs" readonly style="padding:12px 16px; border-radius:8px; font-size:14px" />
            <button class="btn" id="tickToggle" style="padding:10px 20px; border-radius:8px">åœæ­¢</button>
            <button class="btn" id="copyCurrent" style="padding:10px 20px; border-radius:8px">å¤åˆ¶</button>
          </div>
          <div class="muted" style="margin-top:8px; font-size:12px">å®æ—¶æ˜¾ç¤ºå½“å‰æ—¶é—´</div>
        </div>

        <!-- æ—¶é—´æˆ³è½¬æ—¥æœŸæ—¶é—´ -->
        <div style="margin-bottom:32px">
          <div class="flex" style="align-items:center; margin-bottom:12px; gap:8px">
            <span style="font-size:18px">â°</span>
            <span class="muted" style="font-weight:500; font-size:16px">æ—¶é—´æˆ³è½¬æ—¥æœŸæ—¶é—´</span>
          </div>
          <div class="row" style="grid-template-columns:2fr auto 1fr 2fr auto; gap:16px; align-items:center">
            <input id="epochInput" placeholder="1757745558769" style="padding:12px 16px; border-radius:8px; font-size:14px" />
            <select id="epochUnit" style="padding:12px 16px; border-radius:8px; min-width:100px">
              <option value="ms" selected>æ¯«ç§’(ms)</option>
              <option value="s">ç§’(s)</option>
            </select>
            <button class="btn dark" id="btnEpochToDate" style="padding:12px 24px; border-radius:8px; font-weight:500">è½¬æ¢</button>
            <input id="epochOut" readonly placeholder="è½¬æ¢ç»“æœ" style="padding:12px 16px; border-radius:8px; font-size:14px; background:#f8f9fa" />
            <button class="btn" id="copyEpochOut" style="padding:10px 20px; border-radius:8px">å¤åˆ¶</button>
          </div>
        </div>

        <!-- æ—¥æœŸæ—¶é—´è½¬æ—¶é—´æˆ³ -->
        <div>
          <div class="flex" style="align-items:center; margin-bottom:12px; gap:8px">
            <span style="font-size:18px">ğŸ“…</span>
            <span class="muted" style="font-weight:500; font-size:16px">æ—¥æœŸæ—¶é—´è½¬æ—¶é—´æˆ³</span>
          </div>
          <div class="row" style="grid-template-columns:2fr 1fr 2fr auto auto; gap:16px; align-items:center">
            <input id="dtInput" placeholder="2025-09-13 14:39:18" style="padding:12px 16px; border-radius:8px; font-size:14px" />
            <button class="btn dark" id="btnDateToEpoch" style="padding:12px 24px; border-radius:8px; font-weight:500">è½¬æ¢</button>
            <input id="dtOut" readonly placeholder="è½¬æ¢ç»“æœ" style="padding:12px 16px; border-radius:8px; font-size:14px; background:#f8f9fa" />
            <select style="padding:12px 16px; border-radius:8px; min-width:100px">
              <option value="ms" selected>æ¯«ç§’(ms)</option>
            </select>
            <button class="btn" id="copyDtOut" style="padding:10px 20px; border-radius:8px">å¤åˆ¶</button>
          </div>
          <div class="muted" style="margin-top:8px; font-size:12px">å°†è¾“å…¥çš„æ—¥æœŸæ—¶é—´è§†ä¸ºç³»ç»Ÿæœ¬åœ°æ—¶åŒºï¼Œè½¬æ¢ä¸ºæ¯«ç§’æ—¶é—´æˆ³</div>
        </div>
      </div>

      
    </section>

    <section id="panel-diff" role="tabpanel" aria-labelledby="tab-diff" hidden>
      <div class="card">
        <div class="flex" style="justify-content:space-between; align-items:center; margin-bottom:24px">
          <h2>å­—ç¬¦ä¸²å¯¹æ¯”ä¸æ‰‹åŠ¨åˆå¹¶</h2>
          <div class="flex" style="gap:12px">
            <button class="btn dark" id="btnDoDiff" style="padding:10px 20px; border-radius:8px">å¼€å§‹å¯¹æ¯”</button>
            <button class="btn" id="copyMerged" style="padding:10px 20px; border-radius:8px">å¤åˆ¶åˆå¹¶ç»“æœ</button>
          </div>
        </div>

        <!-- è¾“å…¥åŒºåŸŸ -->
        <div class="grid-2" style="margin-bottom:24px">
          <div>
            <div class="muted" style="margin-bottom:8px; font-weight:500">åŸå§‹å­—ç¬¦ä¸²</div>
            <textarea id="leftText" placeholder="åœ¨è¿™é‡Œç²˜è´´å·¦ä¾§ï¼ˆåŸå§‹ï¼‰å­—ç¬¦ä¸²" style="border-radius:8px; padding:16px; font-size:14px; min-height:120px"></textarea>
          </div>
          <div>
            <div class="muted" style="margin-bottom:8px; font-weight:500">å¯¹æ¯”å­—ç¬¦ä¸²</div>
            <textarea id="rightText" placeholder="åœ¨è¿™é‡Œç²˜è´´å³ä¾§ï¼ˆå¯¹æ¯”ï¼‰å­—ç¬¦ä¸²" style="border-radius:8px; padding:16px; font-size:14px; min-height:120px"></textarea>
          </div>
        </div>

        <!-- å·®å¼‚å¯¹æ¯”ç»“æœ -->
        <div id="diffContainer" style="margin-bottom:24px"></div>

        <!-- åˆå¹¶ç»“æœ -->
        <div>
          <div class="muted" style="margin-bottom:8px; font-weight:500">åˆå¹¶ç»“æœï¼ˆå¯äºŒæ¬¡ç¼–è¾‘ï¼‰</div>
          <textarea id="mergedOut" style="border-radius:8px; padding:16px; font-size:14px; min-height:120px; background:#f8f9fa" readonly></textarea>
        </div>
      </div>
    </section>

    <section id="panel-coord" role="tabpanel" aria-labelledby="tab-coord" hidden>
      <div class="card">
        <div class="flex" style="justify-content:space-between; margin-bottom:12px">
          <h2>ç»çº¬åº¦è½¬æ¢</h2>
          <div class="flex">
            <button class="btn" id="clearCoord">æ¸…ç©º</button>
          </div>
        </div>

        <div style="margin-bottom:16px">
          <div class="muted" style="margin-bottom:6px">åŸå§‹åæ ‡</div>
          <div class="row" style="grid-template-columns:1fr 1fr auto; gap:12px; align-items:end">
            <div>
              <input id="sourceLng" placeholder="ç»åº¦ (Longitude)" />
            </div>
            <div>
              <input id="sourceLat" placeholder="çº¬åº¦ (Latitude)" />
            </div>
            <select id="sourceCoordSys">
              <option value="WGS84">WGS84 (å›½é™…æ ‡å‡†)</option>
              <option value="GCJ02">GCJ02 (ç«æ˜Ÿåæ ‡ç³»)</option>
              <option value="BD09">BD09 (ç™¾åº¦åæ ‡ç³»)</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom:16px">
          <div class="muted" style="margin-bottom:6px">ç›®æ ‡åæ ‡ç³»</div>
          <select id="targetCoordSys">
            <option value="WGS84">WGS84 (å›½é™…æ ‡å‡†)</option>
            <option value="GCJ02">GCJ02 (ç«æ˜Ÿåæ ‡ç³»)</option>
            <option value="BD09">BD09 (ç™¾åº¦åæ ‡ç³»)</option>
          </select>
        </div>

        <div style="margin-bottom:16px">
          <button class="btn dark" id="btnConvertCoord">è½¬æ¢åæ ‡</button>
        </div>

        <div>
          <div class="muted" style="margin-bottom:6px">è½¬æ¢ç»“æœ</div>
          <div class="row" style="grid-template-columns:1fr 1fr auto; gap:12px; align-items:center">
            <input id="resultLng" readonly placeholder="ç»åº¦ç»“æœ" />
            <input id="resultLat" readonly placeholder="çº¬åº¦ç»“æœ" />
            <button class="btn" id="copyCoordResult">å¤åˆ¶</button>
          </div>
        </div>

        <div style="margin-top:16px">
          <div class="muted">
            <strong>åæ ‡ç³»è¯´æ˜ï¼š</strong><br/>
            â€¢ <strong>WGS84</strong>ï¼šå›½é™…æ ‡å‡†ï¼ŒGPSè®¾å¤‡ã€Google Earthç­‰ä½¿ç”¨<br/>
            â€¢ <strong>GCJ02</strong>ï¼šä¸­å›½å›½å®¶æµ‹ç»˜å±€åŠ å¯†åæ ‡ï¼Œé«˜å¾·ã€è…¾è®¯åœ°å›¾ç­‰ä½¿ç”¨<br/>
            â€¢ <strong>BD09</strong>ï¼šç™¾åº¦åŠ å¯†åæ ‡ï¼Œç™¾åº¦åœ°å›¾ä½¿ç”¨
          </div>
        </div>
      </div>

      <div class="card">
        <div class="flex" style="justify-content:space-between; margin-bottom:12px">
          <h2>æ‰¹é‡è½¬æ¢</h2>
          <div class="flex">
            <button class="btn" id="btnBatchConvert">æ‰¹é‡è½¬æ¢</button>
            <button class="btn" id="copyBatchResult">å¤åˆ¶ç»“æœ</button>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <div class="muted" style="margin-bottom:6px">è¾“å…¥åæ ‡ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šç»åº¦,çº¬åº¦ï¼‰</div>
            <textarea id="batchInput" placeholder="116.397128,39.916527
121.473701,31.230416
113.264435,23.129163"></textarea>
          </div>
          <div>
            <div class="muted" style="margin-bottom:6px">è½¬æ¢ç»“æœ</div>
            <textarea id="batchOutput" readonly></textarea>
          </div>
        </div>

        <div class="row" style="grid-template-columns:1fr 1fr; gap:16px; margin-top:12px">
          <div>
            <label class="muted">æºåæ ‡ç³»ï¼š</label>
            <select id="batchSourceCoordSys">
              <option value="WGS84">WGS84</option>
              <option value="GCJ02">GCJ02</option>
              <option value="BD09">BD09</option>
            </select>
          </div>
          <div>
            <label class="muted">ç›®æ ‡åæ ‡ç³»ï¼š</label>
            <select id="batchTargetCoordSys">
              <option value="WGS84">WGS84</option>
              <option value="GCJ02">GCJ02</option>
              <option value="BD09">BD09</option>
            </select>
          </div>
        </div>
      </div>
    </section>

    <footer>Â© <span id="year"></span> â€“ Devin - juju</footer>
  </div>

<script>
// ---------------------- Utils ----------------------
function $(sel, root=document){return root.querySelector(sel)}
function h(tag, props={}, ...children){const el=document.createElement(tag);Object.assign(el, props);children.flat().forEach(c=>{if(c==null)return; if(c.nodeType) el.appendChild(c); else el.appendChild(document.createTextNode(String(c)));});return el}
function classNames(){return Array.from(arguments).filter(Boolean).join(' ')}

// Clipboard fallback
async function copyWithFallback(text){
  try{ if(navigator.clipboard){ await navigator.clipboard.writeText(text); return {ok:true}; } }catch(e){}
  try{ const ta=h('textarea',{value:text,style:'position:fixed;opacity:0;left:-9999px'}); document.body.appendChild(ta); ta.select(); document.execCommand('copy'); document.body.removeChild(ta); return {ok:true}; }catch(e){}
  return {ok:false};
}
function withToast(wrapperEl, fn){
  return async()=>{
    const res=await fn();
    const toast=h('div',{className:'toast'}, res && res.ok? 'å·²å¤åˆ¶':'å¤åˆ¶å¤±è´¥');
    wrapperEl.appendChild(toast); setTimeout(()=>toast.remove(),1600);
  }
}

// ---------------------- Tabs ----------------------
(function initTabs(){
  const tabTs=$('#tab-ts'), tabDiff=$('#tab-diff'), tabCoord=$('#tab-coord');
  const panelTs=$('#panel-ts'), panelDiff=$('#panel-diff'), panelCoord=$('#panel-coord');
  function activate(key){
    const isTs=key==='ts', isDiff=key==='diff', isCoord=key==='coord';
    tabTs.setAttribute('aria-selected', isTs);
    tabDiff.setAttribute('aria-selected', isDiff);
    tabCoord.setAttribute('aria-selected', isCoord);
    panelTs.hidden=!isTs; panelDiff.hidden=!isDiff; panelCoord.hidden=!isCoord;
  }
  tabTs.addEventListener('click',()=>activate('ts'));
  tabDiff.addEventListener('click',()=>activate('diff'));
  tabCoord.addEventListener('click',()=>activate('coord'));
  activate('ts');
})();

// ---------------------- Timestamp Tools ----------------------
(function initTimestamp(){
  const currentTs=$('#currentTs');
  const tickToggle=$('#tickToggle');
  const copyCurrent=$('#copyCurrent');

  // æ›´æ–°å½“å‰æ—¶é—´æ˜¾ç¤º
  function updateCurrent(){ 
    const now = new Date();
    const formatted = now.getFullYear()+'-'+(now.getMonth()+1).toString().padStart(2,'0')+'-'+now.getDate().toString().padStart(2,'0')+' '+now.getHours().toString().padStart(2,'0')+':'+now.getMinutes().toString().padStart(2,'0')+':'+now.getSeconds().toString().padStart(2,'0');
    currentTs.value = formatted;
  }
  
  let running=true; let timer=setInterval(updateCurrent,250); updateCurrent();
  
  tickToggle.addEventListener('click',()=>{ 
    running=!running; 
    tickToggle.textContent=running?'åœæ­¢':'å¯åŠ¨'; 
    if(running){ 
      timer=setInterval(updateCurrent,250);
    } else { 
      clearInterval(timer);
    } 
  });
  
  copyCurrent.addEventListener('click', async()=>{ await copyWithFallback(currentTs.value); });

  // ä¸‹æ–¹è½¬æ¢ï¼šè¿›å…¥æ—¶è‡ªåŠ¨å¸¦å…¥è¿›å…¥æ—¶åˆ»ï¼ˆæ¯«ç§’ï¼‰
  const epochInput=$('#epochInput'); epochInput.value=String(Date.now());
  const epochUnit=$('#epochUnit'); epochUnit.value='ms';
  epochUnit.addEventListener('change',()=>{
    const prev=epochInput.value.trim(); if(!prev) return;
    if(epochUnit.value==='ms'){ 
      // ä»ç§’è½¬ä¸ºæ¯«ç§’
      epochInput.value = prev + '000'; 
    } else { 
      // ä»æ¯«ç§’è½¬ä¸ºç§’
      epochInput.value = prev.endsWith('000') ? prev.slice(0,-3) : String(Math.floor(Number(prev)/1000)); 
    }
  });

  const epochOut=$('#epochOut');
  $('#btnEpochToDate').addEventListener('click',()=>{
    const raw=epochInput.value.trim(); if(!raw){ epochOut.value=''; return; }
    const n=Number(raw); if(Number.isNaN(n)){ epochOut.value='æ ¼å¼é”™è¯¯'; return; }
    const tsMs= epochUnit.value==='ms' ? n : n*1000;
    const d=new Date(tsMs);
    epochOut.value = d.getFullYear()+'-'+(d.getMonth()+1).toString().padStart(2,'0')+'-'+d.getDate().toString().padStart(2,'0')+' '+d.getHours().toString().padStart(2,'0')+':'+d.getMinutes().toString().padStart(2,'0')+':'+d.getSeconds().toString().padStart(2,'0');
  });
  $('#copyEpochOut').addEventListener('click', async()=>{ await copyWithFallback(epochOut.value); });

  const dtInput=$('#dtInput'); const dtOut=$('#dtOut');
  $('#btnDateToEpoch').addEventListener('click',()=>{
    const input = dtInput.value.trim();
    if(!input) { dtOut.value=''; return; }
    
    const s=input.replace('T',' ');
    const m=s.match(/^(\d{4})-(\d{2})-(\d{2})[ T](\d{2}):(\d{2})(?::(\d{2}))?$/);
    if(!m) { dtOut.value='æ ¼å¼é”™è¯¯ï¼Œç¤ºä¾‹ï¼š2025-09-13 11:19:55'; return; }
    
    const [,y,M,d,h,mn,ss]=m;
    const localDate = new Date(+y, +M-1, +d, +h, +mn, +(ss||0));
    dtOut.value=String(localDate.getTime());
  });
  $('#copyDtOut').addEventListener('click', async()=>{ await copyWithFallback(dtOut.value); });
})();

// ---------------------- Tests (removed as elements don't exist) ----------------------

// ---------------------- Coordinate Conversion ----------------------
(function initCoordConversion(){
  // åæ ‡è½¬æ¢ç®—æ³•
  const PI = Math.PI;
  const A = 6378245.0;
  const EE = 0.00669342162296594323;
  
  function outOfChina(lng, lat) {
    return (lng < 72.004 || lng > 137.8347) || (lat < 0.8293 || lat > 55.8271);
  }
  
  function transformLat(lng, lat) {
    let ret = -100.0 + 2.0 * lng + 3.0 * lat + 0.2 * lat * lat + 0.1 * lng * lat + 0.2 * Math.sqrt(Math.abs(lng));
    ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
    ret += (20.0 * Math.sin(lat * PI) + 40.0 * Math.sin(lat / 3.0 * PI)) * 2.0 / 3.0;
    ret += (160.0 * Math.sin(lat / 12.0 * PI) + 320 * Math.sin(lat * PI / 30.0)) * 2.0 / 3.0;
    return ret;
  }
  
  function transformLng(lng, lat) {
    let ret = 300.0 + lng + 2.0 * lat + 0.1 * lng * lng + 0.1 * lng * lat + 0.1 * Math.sqrt(Math.abs(lng));
    ret += (20.0 * Math.sin(6.0 * lng * PI) + 20.0 * Math.sin(2.0 * lng * PI)) * 2.0 / 3.0;
    ret += (20.0 * Math.sin(lng * PI) + 40.0 * Math.sin(lng / 3.0 * PI)) * 2.0 / 3.0;
    ret += (150.0 * Math.sin(lng / 12.0 * PI) + 300.0 * Math.sin(lng / 30.0 * PI)) * 2.0 / 3.0;
    return ret;
  }
  
  // WGS84 to GCJ02
  function wgs84ToGcj02(lng, lat) {
    if (outOfChina(lng, lat)) return [lng, lat];
    let dLat = transformLat(lng - 105.0, lat - 35.0);
    let dLng = transformLng(lng - 105.0, lat - 35.0);
    const radLat = lat / 180.0 * PI;
    let magic = Math.sin(radLat);
    magic = 1 - EE * magic * magic;
    const sqrtMagic = Math.sqrt(magic);
    dLat = (dLat * 180.0) / ((A * (1 - EE)) / (magic * sqrtMagic) * PI);
    dLng = (dLng * 180.0) / (A / sqrtMagic * Math.cos(radLat) * PI);
    return [lng + dLng, lat + dLat];
  }
  
  // GCJ02 to WGS84
  function gcj02ToWgs84(lng, lat) {
    if (outOfChina(lng, lat)) return [lng, lat];
    let dLat = transformLat(lng - 105.0, lat - 35.0);
    let dLng = transformLng(lng - 105.0, lat - 35.0);
    const radLat = lat / 180.0 * PI;
    let magic = Math.sin(radLat);
    magic = 1 - EE * magic * magic;
    const sqrtMagic = Math.sqrt(magic);
    dLat = (dLat * 180.0) / ((A * (1 - EE)) / (magic * sqrtMagic) * PI);
    dLng = (dLng * 180.0) / (A / sqrtMagic * Math.cos(radLat) * PI);
    return [lng - dLng, lat - dLat];
  }
  
  // GCJ02 to BD09
  function gcj02ToBd09(lng, lat) {
    const z = Math.sqrt(lng * lng + lat * lat) + 0.00002 * Math.sin(lat * PI * 3000.0 / 180.0);
    const theta = Math.atan2(lat, lng) + 0.000003 * Math.cos(lng * PI * 3000.0 / 180.0);
    const bdLng = z * Math.cos(theta) + 0.0065;
    const bdLat = z * Math.sin(theta) + 0.006;
    return [bdLng, bdLat];
  }
  
  // BD09 to GCJ02
  function bd09ToGcj02(lng, lat) {
    const x = lng - 0.0065;
    const y = lat - 0.006;
    const z = Math.sqrt(x * x + y * y) - 0.00002 * Math.sin(y * PI * 3000.0 / 180.0);
    const theta = Math.atan2(y, x) - 0.000003 * Math.cos(x * PI * 3000.0 / 180.0);
    const gcjLng = z * Math.cos(theta);
    const gcjLat = z * Math.sin(theta);
    return [gcjLng, gcjLat];
  }
  
  // ä¸»è½¬æ¢å‡½æ•°
  function convertCoordinates(lng, lat, fromSys, toSys) {
    if (fromSys === toSys) return [lng, lat];
    
    let result = [lng, lat];
    
    // å…ˆè½¬æ¢åˆ°GCJ02ä½œä¸ºä¸­é—´åæ ‡ç³»
    if (fromSys === 'WGS84') {
      result = wgs84ToGcj02(lng, lat);
    } else if (fromSys === 'BD09') {
      result = bd09ToGcj02(lng, lat);
    }
    
    // ä»GCJ02è½¬æ¢åˆ°ç›®æ ‡åæ ‡ç³»
    if (toSys === 'WGS84') {
      result = gcj02ToWgs84(result[0], result[1]);
    } else if (toSys === 'BD09') {
      result = gcj02ToBd09(result[0], result[1]);
    }
    
    return result;
  }
  
  // UI ç»‘å®š
  const sourceLng = $('#sourceLng');
  const sourceLat = $('#sourceLat');
  const sourceCoordSys = $('#sourceCoordSys');
  const targetCoordSys = $('#targetCoordSys');
  const resultLng = $('#resultLng');
  const resultLat = $('#resultLat');
  
  $('#btnConvertCoord').addEventListener('click', () => {
    const lng = parseFloat(sourceLng.value);
    const lat = parseFloat(sourceLat.value);
    
    if (isNaN(lng) || isNaN(lat)) {
      resultLng.value = 'è¯·è¾“å…¥æœ‰æ•ˆçš„ç»çº¬åº¦';
      resultLat.value = '';
      return;
    }
    
    if (lng < -180 || lng > 180 || lat < -90 || lat > 90) {
      resultLng.value = 'åæ ‡èŒƒå›´é”™è¯¯';
      resultLat.value = 'ç»åº¦[-180,180]ï¼Œçº¬åº¦[-90,90]';
      return;
    }
    
    try {
      const result = convertCoordinates(lng, lat, sourceCoordSys.value, targetCoordSys.value);
      resultLng.value = result[0].toFixed(8);
      resultLat.value = result[1].toFixed(8);
    } catch (e) {
      resultLng.value = 'è½¬æ¢å¤±è´¥';
      resultLat.value = e.message;
    }
  });
  
  $('#clearCoord').addEventListener('click', () => {
    sourceLng.value = '';
    sourceLat.value = '';
    resultLng.value = '';
    resultLat.value = '';
  });
  
  $('#copyCoordResult').addEventListener('click', async () => {
    const result = `${resultLng.value},${resultLat.value}`;
    await copyWithFallback(result);
  });
  
  // æ‰¹é‡è½¬æ¢
  const batchInput = $('#batchInput');
  const batchOutput = $('#batchOutput');
  const batchSourceCoordSys = $('#batchSourceCoordSys');
  const batchTargetCoordSys = $('#batchTargetCoordSys');
  
  $('#btnBatchConvert').addEventListener('click', () => {
    const lines = batchInput.value.split('\n').filter(line => line.trim());
    const results = [];
    
    for (const line of lines) {
      const parts = line.trim().split(',');
      if (parts.length !== 2) {
        results.push(`${line} - æ ¼å¼é”™è¯¯`);
        continue;
      }
      
      const lng = parseFloat(parts[0]);
      const lat = parseFloat(parts[1]);
      
      if (isNaN(lng) || isNaN(lat)) {
        results.push(`${line} - æ— æ•ˆåæ ‡`);
        continue;
      }
      
      try {
        const result = convertCoordinates(lng, lat, batchSourceCoordSys.value, batchTargetCoordSys.value);
        results.push(`${result[0].toFixed(8)},${result[1].toFixed(8)}`);
      } catch (e) {
        results.push(`${line} - è½¬æ¢å¤±è´¥`);
      }
    }
    
    batchOutput.value = results.join('\n');
  });
  
  $('#copyBatchResult').addEventListener('click', async () => {
    await copyWithFallback(batchOutput.value);
  });
})();

// ---------------------- Diff & Merge ----------------------
(function initDiff(){
  const left=$('#leftText'); const right=$('#rightText');
  const container=$('#diffContainer'); const mergedOut=$('#mergedOut');
  const copyMerged=$('#copyMerged'); copyMerged.addEventListener('click', async()=>{ await copyWithFallback(mergedOut.value); });

  function tokenize(str){ const arr=[]; let buf=''; const flush=()=>{ if(buf){arr.push({t:buf,k:'w'}); buf='';}}; for(const ch of str){ if(/\w|[\u4e00-\u9fa5]/.test(ch)) buf+=ch; else { flush(); arr.push({t:ch,k:'s'});} } flush(); return arr; }
  function lcs(a,b){ const n=a.length,m=b.length; const dp=Array.from({length:n+1},()=>Array(m+1).fill(0)); for(let i=n-1;i>=0;i--){ for(let j=m-1;j>=0;j--){ dp[i][j] = a[i].t===b[j].t ? dp[i+1][j+1]+1 : Math.max(dp[i+1][j], dp[i][j+1]); } } const res=[]; let i=0,j=0; while(i<n&&j<m){ if(a[i].t===b[j].t){ res.push({type:'eq',token:a[i]}); i++; j++; } else if(dp[i+1][j]>=dp[i][j+1]){ res.push({type:'del',token:a[i++]}); } else { res.push({type:'add',token:b[j++]}); } } while(i<n) res.push({type:'del',token:a[i++]}); while(j<m) res.push({type:'add',token:b[j++]}); return res; }

  function doDiff(){
    const A=tokenize(left.value||'');
    const B=tokenize(right.value||'');
    const seq=lcs(A,B);
    const groups=[]; let i=0; while(i<seq.length){ const cur=seq[i]; if(cur.type==='eq'){ let text=cur.token.t; i++; while(i<seq.length && seq[i].type==='eq'){ text+=seq[i].token.t; i++; } groups.push({kind:'eq', a:text, b:text, key:groups.length}); continue; } let dels=''; while(i<seq.length && seq[i].type==='del'){ dels+=seq[i].token.t; i++; } let adds=''; while(i<seq.length && seq[i].type==='add'){ adds+=seq[i].token.t; i++; } if(dels && adds) groups.push({kind:'replace', a:dels, b:adds, key:groups.length}); else if(dels) groups.push({kind:'del', a:dels, b:'', key:groups.length}); else if(adds) groups.push({kind:'add', a:'', b:adds, key:groups.length}); }

    container.innerHTML=''; const picked={};
    groups.forEach(g=>{
      if(g.kind!=='eq') picked[g.key]='right';
      
      // ä¸ºä¸åŒç±»å‹è®¾ç½®ä¸åŒçš„æ ‡é¢˜å’Œé¢œè‰²
      let title, bgColor;
      switch(g.kind) {
        case 'eq': title='âœ“ ä¸€è‡´'; bgColor='#f0f9ff'; break;
        case 'add': title='+ æ–°å¢ï¼ˆå³ä¾§ï¼‰'; bgColor='#f0fdf4'; break;
        case 'del': title='- åˆ é™¤ï¼ˆå·¦ä¾§ï¼‰'; bgColor='#fef2f2'; break;
        case 'replace': title='âš  æ›¿æ¢'; bgColor='#fffbeb'; break;
      }
      
      const diffBlock = h('div', {
        style: `background:${bgColor}; border:1px solid ${g.kind==='eq'?'#e5e7eb':g.kind==='add'?'#22c55e':g.kind==='del'?'#ef4444':'#f59e0b'}; border-radius:12px; margin-bottom:16px; overflow:hidden`
      });
      
      // æ ‡é¢˜æ 
      const header = h('div', {
        style: 'display:flex; justify-content:space-between; align-items:center; padding:12px 16px; border-bottom:1px solid rgba(0,0,0,0.1); font-weight:500'
      }, title);
      
      // å¦‚æœä¸æ˜¯ä¸€è‡´çš„å†…å®¹ï¼Œæ·»åŠ é€‰æ‹©æŒ‰é’®
      if(g.kind !== 'eq') {
        const buttonGroup = h('div', {
          style: 'display:flex; gap:8px'
        });
        
        const leftBtn = h('button', {
          className: 'btn',
          style: 'padding:6px 12px; border-radius:6px; font-size:12px; background:#fff; border:1px solid #d1d5db',
          textContent: 'é€‰æ‹©å·¦ä¾§',
          onclick: () => {
            picked[g.key]='left';
            leftBtn.style.background='#3b82f6';
            leftBtn.style.color='#fff';
            rightBtn.style.background='#fff';
            rightBtn.style.color='#000';
            renderMerged();
          }
        });
        
        const rightBtn = h('button', {
          className: 'btn',
          style: 'padding:6px 12px; border-radius:6px; font-size:12px; background:#3b82f6; color:#fff; border:1px solid #3b82f6',
          textContent: 'é€‰æ‹©å³ä¾§',
          onclick: () => {
            picked[g.key]='right';
            rightBtn.style.background='#3b82f6';
            rightBtn.style.color='#fff';
            leftBtn.style.background='#fff';
            leftBtn.style.color='#000';
            renderMerged();
          }
        });
        
        buttonGroup.appendChild(leftBtn);
        buttonGroup.appendChild(rightBtn);
        header.appendChild(buttonGroup);
      }
      
      // å†…å®¹åŒºåŸŸ
      const content = h('div', {
        style: 'display:grid; grid-template-columns:1fr 1fr; gap:1px; background:#e5e7eb'
      });
      
      const leftContent = h('div', {
        style: 'padding:16px; background:#fff; font-family:monospace; white-space:pre-wrap; word-break:break-all'
      }, g.a || 'âˆ… ç©ºå†…å®¹');
      
      const rightContent = h('div', {
        style: 'padding:16px; background:#fff; font-family:monospace; white-space:pre-wrap; word-break:break-all'
      }, g.b || 'âˆ… ç©ºå†…å®¹');
      
      content.appendChild(leftContent);
      content.appendChild(rightContent);
      
      diffBlock.appendChild(header);
      diffBlock.appendChild(content);
      container.appendChild(diffBlock);
    });

    function renderMerged(){ mergedOut.value = groups.map(g=> g.kind==='eq'? g.a : (picked[g.key]==='left'? g.a : g.b)).join(''); }
    renderMerged();
  }

  $('#btnDoDiff').addEventListener('click', doDiff);
})();

// Misc
const toTopEl = $('#toTop');
if (toTopEl) {
  toTopEl.addEventListener('click',()=>window.scrollTo({top:0,behavior:'smooth'}));
}
$('#year').textContent = new Date().getFullYear();
</script>
</body>
</html>
